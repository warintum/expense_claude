<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
        }

        .income-card .card-icon {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
        }

        .expense-card .card-icon {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .balance-card .card-icon {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        .card-title {
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }

        .card-value {
            font-size: 2em;
            font-weight: 700;
            color: #333;
        }

        .income-value { color: #10b981; }
        .expense-value { color: #ef4444; }
        .balance-value { color: #3b82f6; }

        .form-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .form-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-family: 'Prompt', sans-serif;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-family: 'Prompt', sans-serif;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            background: white;
            color: #667eea;
            font-family: 'Prompt', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .transaction-list {
            display: grid;
            gap: 15px;
        }

        .transaction-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid;
            transition: all 0.3s ease;
        }

        .transaction-item:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .transaction-item.income {
            border-left-color: #10b981;
            background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%);
        }

        .transaction-item.expense {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, #ffffff 0%, #fef2f2 100%);
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-type {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .transaction-desc {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .transaction-date {
            font-size: 0.85em;
            color: #999;
        }

        .transaction-amount {
            font-size: 1.5em;
            font-weight: 700;
            margin: 0 20px;
        }

        .transaction-amount.income {
            color: #10b981;
        }

        .transaction-amount.expense {
            color: #ef4444;
        }

        .transaction-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.9em;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .fixed-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .fixed-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid;
        }

        .fixed-item.income {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left-color: #10b981;
        }

        .fixed-item.expense {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-left-color: #ef4444;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .transaction-amount {
                margin: 10px 0;
            }

            .transaction-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h1>
        </div>

        <!-- Dashboard Cards -->
        <div class="dashboard">
            <div class="card income-card">
                <div class="card-header">
                    <div class="card-icon">üìà</div>
                    <div class="card-title">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°</div>
                </div>
                <div class="card-value income-value" id="totalIncome">0.00</div>
            </div>

            <div class="card expense-card">
                <div class="card-header">
                    <div class="card-icon">üìâ</div>
                    <div class="card-title">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div>
                </div>
                <div class="card-value expense-value" id="totalExpense">0.00</div>
            </div>

            <div class="card balance-card">
                <div class="card-header">
                    <div class="card-icon">üíµ</div>
                    <div class="card-title">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
                </div>
                <div class="card-value balance-value" id="balance">0.00</div>
            </div>
        </div>

        <!-- Fixed Monthly Section -->
        <div class="fixed-section">
            <div class="form-title">üìå ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
            <div class="btn-group" style="margin-bottom: 15px;">
                <button class="btn btn-success btn-small" onclick="showFixedModal('income')">+ ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡∏á‡∏ó‡∏µ‡πà</button>
                <button class="btn btn-danger btn-small" onclick="showFixedModal('expense')">+ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà</button>
            </div>
            <div id="fixedList"></div>
        </div>

        <!-- Transaction Form -->
        <div class="form-card">
            <div class="form-title">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</div>
            <form id="transactionForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                        <select id="type" required>
                            <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
                            <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="amount" step="0.01" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                    <input type="text" id="description" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="date" required>
                    </div>
                    <div class="form-group">
                        <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                        <input type="text" id="category" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô">
                    </div>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button type="button" class="btn btn-secondary" onclick="exportCSV()">üì• Export CSV</button>
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì§ Import CSV</button>
                    <button type="button" class="btn btn-danger" onclick="clearData()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
                <input type="file" id="importFile" accept=".csv" style="display:none" onchange="importCSV(event)">
            </form>
        </div>

        <!-- Filter Tabs -->
        <div class="form-card">
            <div class="filter-tabs">
                <button class="tab-btn active" onclick="filterTransactions('all')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button class="tab-btn" onclick="filterTransactions('day')">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
                <button class="tab-btn" onclick="filterTransactions('week')">‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button>
                <button class="tab-btn" onclick="filterTransactions('month')">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                <button class="tab-btn" onclick="filterTransactions('year')">‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</button>
            </div>

            <div class="transaction-list" id="transactionList"></div>
        </div>
    </div>

    <!-- Modal for Fixed Items -->
    <div id="fixedModal" class="modal">
        <div class="modal-content">
            <div class="form-title" id="modalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏á‡∏ó‡∏µ‡πà</div>
            <form id="fixedForm">
                <div class="form-group">
                    <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                    <input type="text" id="fixedDesc" required>
                </div>
                <div class="form-group">
                    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="fixedAmount" step="0.01" required>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button type="button" class="btn btn-secondary" onclick="closeFixedModal()">‡∏õ‡∏¥‡∏î</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="form-title">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
            <form id="editForm">
                <div class="form-group">
                    <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                    <select id="editType" required>
                        <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
                        <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="editAmount" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                    <input type="text" id="editDescription" required>
                </div>
                <div class="form-group">
                    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                    <input type="date" id="editDate" required>
                </div>
                <div class="form-group">
                    <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                    <input type="text" id="editCategory">
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let fixedItems = JSON.parse(localStorage.getItem('fixedItems')) || [];
        let currentFilter = 'all';
        let editingId = null;
        let currentFixedType = 'income';

        // Set today's date as default
        document.getElementById('date').valueAsDate = new Date();

        // Transaction Form Submit
        document.getElementById('transactionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const transaction = {
                id: Date.now(),
                type: document.getElementById('type').value,
                amount: parseFloat(document.getElementById('amount').value),
                description: document.getElementById('description').value,
                date: document.getElementById('date').value,
                category: document.getElementById('category').value || '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'
            };

            transactions.push(transaction);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            
            this.reset();
            document.getElementById('date').valueAsDate = new Date();
            updateDashboard();
            displayTransactions();
        });

        // Fixed Form Submit
        document.getElementById('fixedForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const fixed = {
                id: Date.now(),
                type: currentFixedType,
                description: document.getElementById('fixedDesc').value,
                amount: parseFloat(document.getElementById('fixedAmount').value)
            };

            fixedItems.push(fixed);
            localStorage.setItem('fixedItems', JSON.stringify(fixedItems));
            
            this.reset();
            closeFixedModal();
            displayFixedItems();
            updateDashboard();
        });

        // Edit Form Submit
        document.getElementById('editForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const index = transactions.findIndex(t => t.id === editingId);
            if (index !== -1) {
                transactions[index] = {
                    id: editingId,
                    type: document.getElementById('editType').value,
                    amount: parseFloat(document.getElementById('editAmount').value),
                    description: document.getElementById('editDescription').value,
                    date: document.getElementById('editDate').value,
                    category: document.getElementById('editCategory').value || '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'
                };
                
                localStorage.setItem('transactions', JSON.stringify(transactions));
                updateDashboard();
                displayTransactions();
                closeEditModal();
            }
        });

        function showFixedModal(type) {
            currentFixedType = type;
            document.getElementById('modalTitle').textContent = type === 'income' ? '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡∏á‡∏ó‡∏µ‡πà' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà';
            document.getElementById('fixedModal').classList.add('active');
        }

        function closeFixedModal() {
            document.getElementById('fixedModal').classList.remove('active');
            document.getElementById('fixedForm').reset();
        }

        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (transaction) {
                editingId = id;
                document.getElementById('editType').value = transaction.type;
                document.getElementById('editAmount').value = transaction.amount;
                document.getElementById('editDescription').value = transaction.description;
                document.getElementById('editDate').value = transaction.date;
                document.getElementById('editCategory').value = transaction.category;
                document.getElementById('editModal').classList.add('active');
            }
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            editingId = null;
        }

        function deleteTransaction(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) {
                transactions = transactions.filter(t => t.id !== id);
                localStorage.setItem('transactions', JSON.stringify(transactions));
                updateDashboard();
                displayTransactions();
            }
        }

        function deleteFixed(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ?')) {
                fixedItems = fixedItems.filter(f => f.id !== id);
                localStorage.setItem('fixedItems', JSON.stringify(fixedItems));
                displayFixedItems();
                updateDashboard();
            }
        }

        function updateDashboard() {
            let filtered = getFilteredTransactions();
            
            const totalIncome = filtered
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const totalExpense = filtered
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);

            const fixedIncome = fixedItems
                .filter(f => f.type === 'income')
                .reduce((sum, f) => sum + f.amount, 0);
            
            const fixedExpense = fixedItems
                .filter(f => f.type === 'expense')
                .reduce((sum, f) => sum + f.amount, 0);

            const finalIncome = totalIncome + fixedIncome;
            const finalExpense = totalExpense + fixedExpense;
            const balance = finalIncome - finalExpense;

            document.getElementById('totalIncome').textContent = finalIncome.toFixed(2);
            document.getElementById('totalExpense').textContent = finalExpense.toFixed(2);
            document.getElementById('balance').textContent = balance.toFixed(2);
        }

        function displayFixedItems() {
            const list = document.getElementById('fixedList');
            
            if (fixedItems.length === 0) {
                list.innerHTML = '<p style="color: #999; text-align: center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏á‡∏ó‡∏µ‡πà</p>';
                return;
            }

            list.innerHTML = fixedItems.map(item => `
                <div class="fixed-item ${item.type}">
                    <div>
                        <div style="font-weight: 600;">${item.description}</div>
                        <div style="font-size: 0.9em; color: #666;">${item.type === 'income' ? '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö' : '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢'}</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span style="font-size: 1.3em; font-weight: 700; color: ${item.type === 'income' ? '#10b981' : '#ef4444'}">
                            ${item.amount.toFixed(2)} ‡∏ø
                        </span>
                        <button class="btn btn-danger btn-small" onclick="deleteFixed(${item.id})">‡∏•‡∏ö</button>
                    </div>
                </div>
            `).join('');
        }

        function getFilteredTransactions() {
            const now = new Date();
            
            switch(currentFilter) {
                case 'day':
                    return transactions.filter(t => t.date === now.toISOString().split('T')[0]);
                case 'week':
                    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    return transactions.filter(t => new Date(t.date) >= weekAgo);
                case 'month':
                    return transactions.filter(t => {
                        const d = new Date(t.date);
                        return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
                    });
                case 'year':
                    return transactions.filter(t => new Date(t.date).getFullYear() === now.getFullYear());
                default:
                    return transactions;
            }
        }

        function filterTransactions(filter) {
            currentFilter = filter;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateDashboard();
            displayTransactions();
        }

        function displayTransactions() {
            const list = document.getElementById('transactionList');
            const filtered = getFilteredTransactions().sort((a, b) => new Date(b.date) - new Date(a.date));

            if (filtered.length === 0) {
                list.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>';
                return;
            }

            list.innerHTML = filtered.map(t => `
                <div class="transaction-item ${t.type}">
                    <div class="transaction-info">
                        <div class="transaction-type">${t.type === 'income' ? 'üìà ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö' : 'üìâ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢'} ¬∑ ${t.category}</div>
                        <div class="transaction-desc">${t.description}</div>
                        <div class="transaction-date">üìÖ ${new Date(t.date).toLocaleDateString('th-TH')}</div>
                    </div>
                    <div class="transaction-amount ${t.type}">${t.amount.toFixed(2)} ‡∏ø</div>
                    <div class="transaction-actions">
                        <button class="btn btn-secondary btn-small" onclick="editTransaction(${t.id})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button class="btn btn-danger btn-small" onclick="deleteTransaction(${t.id})">‡∏•‡∏ö</button>
                    </div>
                </div>
            `).join('');
        }

        function exportCSV() {
            const csv = [
                ['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó', '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î', '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô'],
                ...transactions.map(t => [t.date, t.type, t.description, t.category, t.amount]),
                [],
                ['‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏á‡∏ó‡∏µ‡πà'],
                ['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó', '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô'],
                ...fixedItems.map(f => [f.type, f.description, f.amount])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function importCSV(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const lines = e.target.result.split('\n').map(line => line.split(','));
                
                transactions = [];
                fixedItems = [];
                let isFixed = false;

                for (let i = 1; i < lines.length; i++) {
                    if (lines[i][0] === '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏á‡∏ó‡∏µ‡πà') {
                        isFixed = true;
                        i++;
                        continue;
                    }

                    if (!isFixed && lines[i].length >= 5) {
                        transactions.push({
                            id: Date.now() + i,
                            date: lines[i][0],
                            type: lines[i][1],
                            description: lines[i][2],
                            category: lines[i][3],
                            amount: parseFloat(lines[i][4])
                        });
                    } else if (isFixed && lines[i].length >= 3) {
                        fixedItems.push({
                            id: Date.now() + i,
                            type: lines[i][0],
                            description: lines[i][1],
                            amount: parseFloat(lines[i][2])
                        });
                    }
                }

                localStorage.setItem('transactions', JSON.stringify(transactions));
                localStorage.setItem('fixedItems', JSON.stringify(fixedItems));
                updateDashboard();
                displayTransactions();
                displayFixedItems();
                alert('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            };
            reader.readAsText(file);
        }

        function clearData() {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) {
                localStorage.removeItem('transactions');
                localStorage.removeItem('fixedItems');
                transactions = [];
                fixedItems = [];
                updateDashboard();
                displayTransactions();
                displayFixedItems();
            }
        }

        // Initialize
        updateDashboard();
        displayTransactions();
        displayFixedItems();
    </script>
</body>
</html>